<center><h1>
  Document of CShaperAPP
  </h1></center>

<p align="center">Authors: Jianfeng Cao, Lihan Hu, Hong Yan</p>

<h2>
  Introduction
</h2>
<p align="justify">This document describes the usage of CShaperAPP. CShaperAPP is built based on the CShaper published in <I>Nature Communications</I>, which adopts the deep learning to segmented the <I>C. elegans</I> emebyros at single-cell elevel (Cao JF <I>et al.</I>, <I>Nat. Commun</I>, 2020).</p>

<p align="justify">Generally speaking, CShaperAPP is composed of four functional sections, including <code>Preprocess</code>, <code>Segmentation</code>, <code>Analysis</code> and  <code>Result</code>. While these four parts are designed to be excuted sequentially, they can also be used to process or anlayze the data individually if data has already been prepared. In order to use this software efficiently, especially for <code>Segmentation</code>, GPU acceleration is preferred. However, all components has been tested successfully on basic desktop (RAM=16G, no GPU).</p>

<h2>Usage</h2>
<p align="justify">With the help of microscopy, fluorescent signals of nucleus and membrane are collected through two channels respectly. These images are saved slice by slice. <code>Preprocess</code> is used to composed these slices into a volume according to user's config. Subsequently, <code>Segmentation</code> is used to segment these volumetric images. <code>Analysis</code> is designed to collect biological information, such as volume and surface, from the segmentation result. Finally, <code>Result</code> can be used to inspect the segmentation results interactively.</p>

<h3>Folder Structure</h3>

The folders which are required or generated by CShaperAPP are listed here. 

```html
# 181210plc1p1 is the name of an embryo sample, which can be configured.

Raw Folder/: raw image folder
  |--181210plc1p1/: embryo name
     |--aceNuc/: nucleus lineage file from StarryNite and AceTree
     |--tif/: raw nucleus image
     |--tifR/: raw membrane image
Project Folder/: the target folder where all results will be saved
  |--CellMembrane/: binary membrane surface
  |--CellMembranePostseg/: segmentation results
     |--181210plc1p1/: cell segmentations without cell labels
     |--181210plc1p2/: cell segmentations whose labels can be queried
  |--NucleusLoc/: nucleus location information
  |--RawStack/: stacked membrane and nucleus images
  |--StatShape/: statistical results from the segmentations
     |--181210plc1/: embryo name
        |--181210plc1_contact.csv: cell-cell contact surface
        |--181210plc1_surface.csv: cell surface area
        |--181210plc1_volume.csv: cell volume
  |--TemCellGraph/: Temporary results 
Resource/: resources that are required by CShaperAPP
  |--number_dictionary.csv: pairwise cell name and digital label in the segmentation
  |--TrainedModel/: pretrained model for the deep learning framework
```

<p align="justify">In these files, <code>Raw Folder</code> is the data that the user needs to process. All data generated by CShaperAPP directly or indirectly will be saved to <code>Project Folder</code>. <code>Resource</code> is prequired files which are provided together with our paper. All </p>

<h3>Preprocess</h3>

<h4>Parameters</h4>

<table style="width: 60%">
  <tr>
    <th>Name</th>
    <th>Value</th>
    <th>Example</th>
  </tr>
  <tr>
    <td>Raw Folder</td>
    <td>name of raw data folder</td>
    <td>root/MembRaw</td>
  </tr>
  <tr>
    <td>Embryo Name</td>
    <td>Name of the embryo</td>
    <td>181210plc1p1</td>
  </tr>
  <tr>
    <td>X-Y Resolution</td>
    <td>Intra-slice resolution (&#956m)</td>
    <td>0.09</td>
  </tr>
  <tr>
    <td>Z Resolution</td>
    <td>Inter-slice resolution</td>
    <td>0.42</td>
  </tr>
  <tr>
    <td>Reduce Ratio</td>
    <td>The scale of image to be reduced. Setting this value to be smaller will reduce the time the <code>Segmentation</code> takes, but the resolution will be reduced</td>
    <td>0.3</td>
  <tr>
    <td>Slice Num</td>
    <td>The number of slices at each time point</td>
    <td>68</td>
  </tr>
  <tr>
    <td>Max Time</td>
    <td>The largest time points to be processed (start from t=1)</td>
    <td>100</td>
  </tr>
  <tr>
    <td>Lineage File</td>
    <td>The nucleus lineage file (from StarryNite and AceTree)</td>
    <td>root/MembRaw/181210plc1p1/aceNuc/CD181210plc1p1.csv</td>
  </tr>
  <tr>
    <td>Number Dictionary</td>
    <td>The dictionary used for finding out the cell name according to the segmentation results because only integers as opposed to strings are saved.</td>
    <td>root/Resource/number_dictionary.csv</td>
  </tr>
</table>


